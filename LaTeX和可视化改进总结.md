# LaTeX æ¸²æŸ“ + ç»ƒä¹ é¢˜å¯è§†åŒ–æ”¹è¿›æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¸¤ä¸ªé‡å¤§æ”¹è¿›

### 1. ğŸ“ LaTeX æ•°å­¦å…¬å¼æ¸²æŸ“æ”¯æŒ

#### é—®é¢˜
- AI ç”Ÿæˆçš„æ•°å­¦å…¬å¼ï¼ˆå¦‚ `\( x^2 \)`, `\[ \frac{a}{b} \]`ï¼‰æ— æ³•æ­£ç¡®æ˜¾ç¤º
- ç”¨æˆ·åªèƒ½çœ‹åˆ°åŸå§‹ LaTeX ä»£ç 

#### è§£å†³æ–¹æ¡ˆ
å¼•å…¥ **react-markdown** + **remark-math** + **rehype-katex** åº“æ ˆ

#### æŠ€æœ¯å®ç°

**å®‰è£…çš„åŒ…ï¼š**
```json
{
  "katex": "^0.16.x",
  "react-katex": "^3.x",
  "react-markdown": "^9.x",
  "remark-math": "^6.x",
  "rehype-katex": "^7.x"
}
```

**MessageItem.tsx æ”¹è¿›ï¼š**
```typescript
import ReactMarkdown from 'react-markdown';
import remarkMath from 'remark-math';
import rehypeKatex from 'rehype-katex';
import 'katex/dist/katex.min.css';

// AI æ¶ˆæ¯æ¸²æŸ“
<ReactMarkdown
  remarkPlugins={[remarkMath]}
  rehypePlugins={[rehypeKatex]}
  components={{
    // è‡ªå®šä¹‰æ ·å¼...
  }}
>
  {message.content}
</ReactMarkdown>
```

#### æ”¯æŒçš„ LaTeX æ ¼å¼

**è¡Œå†…å…¬å¼ï¼š**
- `$x^2 + 2x + 1$`
- `\( ax^2 + bx + c \)`

**ç‹¬ç«‹å…¬å¼ï¼š**
```latex
$$
f(x) = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}
$$
```

æˆ–

```latex
\[
\int_0^1 x^2 \, dx = \frac{1}{3}
\]
```

#### é¢å¤–æ”¯æŒçš„ Markdown ç‰¹æ€§
- **ä»£ç å—** - è¯­æ³•é«˜äº®
- **åˆ—è¡¨** - æœ‰åº/æ— åº
- **æ ‡é¢˜** - H1/H2/H3
- **details/summary** - å¯æŠ˜å å†…å®¹ï¼ˆå®Œç¾é€‚åˆç»ƒä¹ é¢˜ç­”æ¡ˆï¼‰

---

### 2. ğŸ“Š ç»ƒä¹ é¢˜ç”Ÿæˆå™¨ + GeoGebra è‡ªåŠ¨å¯è§†åŒ–

#### é—®é¢˜
- ç»ƒä¹ é¢˜ç”Ÿæˆå™¨åªèƒ½ç”Ÿæˆæ–‡æœ¬é¢˜ç›®
- å‡½æ•°ã€å‡ ä½•ç­‰é¢˜ç›®ç¼ºå°‘å¯è§†åŒ–å›¾åƒ
- å­¦ç”Ÿéš¾ä»¥ç›´è§‚ç†è§£é¢˜æ„

#### è§£å†³æ–¹æ¡ˆ
**å°†ç»ƒä¹ é¢˜ç”Ÿæˆå™¨å‡çº§ä¸ºæ”¯æŒå·¥å…·è°ƒç”¨çš„æ™ºèƒ½ä½“**

#### æŠ€æœ¯å®ç°

**å…³é”®æ”¹åŠ¨ï¼š**

1. **æ·»åŠ  GeoGebra å·¥å…·æ”¯æŒ**
```typescript
export class ExerciseGeneratorAgent extends Agent {
  getTools() {
    return geogebraTools;  // æ”¯æŒ7ä¸ª GeoGebra å·¥å…·
  }
}
```

2. **å®ç°æ‰‹åŠ¨å·¥å…·è°ƒç”¨å¾ªç¯**
```typescript
// ç»‘å®šå·¥å…·
const modelWithTools = this.model.bindTools(
  geogebraTools.map(tool => ({
    name: tool.name,
    description: tool.description,
    parameters: tool.schema,
  }))
);

// æ‰‹åŠ¨å¾ªç¯ï¼ˆæœ€å¤š5è½®ï¼‰
while (iterations < maxIterations) {
  const response = await modelWithTools.invoke(currentMessages);
  
  if (response.tool_calls && response.tool_calls.length > 0) {
    // æ‰§è¡Œå·¥å…·
    for (const toolCall of response.tool_calls) {
      const tool = geogebraTools.find(t => t.name === toolCall.name);
      const result = await tool.execute(toolCall.args);
      
      // æ·»åŠ å·¥å…·æ¶ˆæ¯
      currentMessages.push({
        role: 'assistant',
        content: response.content || '',
        tool_calls: [toolCall],
      } as any);

      currentMessages.push({
        role: 'tool',
        content: JSON.stringify(result),
        tool_call_id: toolCall.id,
      } as any);
    }
    iterations++;
    continue;
  }
  
  // è¿”å›æœ€ç»ˆç­”æ¡ˆ
  return { message: response, toolCalls: allToolCalls };
}
```

3. **ä¼˜åŒ–ç³»ç»Ÿæç¤ºè¯**
```
ä½•æ—¶è°ƒç”¨ GeoGebra å·¥å…·ï¼ˆå¿…é¡»éµå®ˆï¼‰ï¼š

### å¿…é¡»è°ƒç”¨çš„æƒ…å†µï¼š
1. **äºŒæ¬¡å‡½æ•°é¢˜ç›®** â†’ è°ƒç”¨ geogebra_plot_function ç»˜åˆ¶æŠ›ç‰©çº¿
2. **ä¸€æ¬¡å‡½æ•°é¢˜ç›®** â†’ è°ƒç”¨ geogebra_plot_function ç»˜åˆ¶ç›´çº¿
3. **ä¸‰è§’å‡½æ•°é¢˜ç›®** â†’ è°ƒç”¨ geogebra_plot_function ç»˜åˆ¶ sin/cos
4. **å‡ ä½•å›¾å½¢é¢˜ç›®** â†’ è°ƒç”¨ç›¸åº”å·¥å…·ç»˜åˆ¶ç‚¹ã€çº¿ã€åœ†
5. **ç§¯åˆ†ç›¸å…³é¢˜ç›®** â†’ è°ƒç”¨ geogebra_plot_integral ç»˜åˆ¶é˜´å½±

### è°ƒç”¨æ—¶æœºï¼š
- åœ¨ç”Ÿæˆé¢˜ç›®**ä¹‹å‰**å…ˆè°ƒç”¨å·¥å…·
- é¢˜ç›®ä¸­æåˆ°å…·ä½“å‡½æ•°è¡¨è¾¾å¼æ—¶å¿…é¡»å¯è§†åŒ–
```

#### ä½¿ç”¨ç¤ºä¾‹

**ç”¨æˆ·è¯·æ±‚ï¼š**
> "ç”Ÿæˆ3é“äºŒæ¬¡å‡½æ•°çš„ä¸­ç­‰éš¾åº¦é¢˜"

**AI è¡Œä¸ºï¼š**
1. **ç¬¬1è½®**ï¼šè°ƒç”¨ `geogebra_plot_function("f1", "x^2-4*x+3")`
2. **ç¬¬2è½®**ï¼šè°ƒç”¨ `geogebra_plot_function("f2", "-x^2+6*x-5")`
3. **ç¬¬3è½®**ï¼šè°ƒç”¨ `geogebra_plot_function("f3", "2*x^2-3*x+1")`
4. **ç¬¬4è½®**ï¼šç”Ÿæˆé¢˜ç›®æ–‡æœ¬ï¼ˆåŒ…å« LaTeX å…¬å¼ï¼‰

**æœ€ç»ˆæ•ˆæœï¼š**
- å·¦ä¾§ï¼šMarkdown + LaTeX æ¸²æŸ“çš„é¢˜ç›®
- å³ä¾§ï¼šGeoGebra ç”»æ¿æ˜¾ç¤º3ä¸ªå‡½æ•°å›¾åƒ
- å­¦ç”Ÿå¯ä»¥ç›´è§‚çœ‹åˆ°å‡½æ•°å½¢çŠ¶ã€é¡¶ç‚¹ã€å¯¹ç§°è½´ç­‰

---

## ğŸ¯ å®Œæ•´å·¥ä½œæµç¨‹

### ç¤ºä¾‹ï¼šç”ŸæˆäºŒæ¬¡å‡½æ•°ç»ƒä¹ é¢˜

**1. ç”¨æˆ·è¯·æ±‚**
```
ç”¨æˆ·ï¼šç”Ÿæˆ2é“äºŒæ¬¡å‡½æ•°çš„é¢˜ç›®
```

**2. AI è°ƒç”¨å·¥å…·ï¼ˆè‡ªåŠ¨ï¼‰**
```
å·¥å…·è°ƒç”¨ 1: geogebra_plot_function
  å‚æ•°: { name: "f", expression: "x^2-4*x+3" }
  ç»“æœ: success
```

**3. AI ç”Ÿæˆé¢˜ç›®ï¼ˆLaTeX + Markdownï¼‰**
```markdown
## ğŸ“‹ ç»ƒä¹ é¢˜é›† - äºŒæ¬¡å‡½æ•°

### éš¾åº¦ï¼šâ­â­ ä¸­ç­‰

> ğŸ“Š **å¯è§†åŒ–å›¾åƒ**ï¼šè¯·æŸ¥çœ‹å³ä¾§ GeoGebra ç”»æ¿

---

### é¢˜ç›® 1ï¼šé€‰æ‹©é¢˜

**é—®é¢˜ï¼š**  
å·²çŸ¥äºŒæ¬¡å‡½æ•° $y = x^2 - 4x + 3$ï¼Œåˆ™å®ƒçš„é¡¶ç‚¹åæ ‡æ˜¯ï¼š

**é€‰é¡¹ï¼š**  
A. $(2, -1)$  
B. $(2, -4)$  
C. $(-2, -1)$  
D. $(1, -2)$

<details>
<summary>ğŸ’¡ ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>

**ç­”æ¡ˆï¼š** A

**è¯¦ç»†è§£æï¼š**
1. é¡¶ç‚¹æ¨ªåæ ‡ï¼š$x = -\frac{b}{2a} = -\frac{-4}{2} = 2$
2. ä»£å…¥å¾—ï¼š$y = (2)^2 - 4(2) + 3 = -1$
3. é¡¶ç‚¹åæ ‡ä¸º $(2, -1)$

**çŸ¥è¯†ç‚¹ï¼š** äºŒæ¬¡å‡½æ•°é¡¶ç‚¹åæ ‡æ±‚æ³•  
**æ˜“é”™ç‚¹ï¼š** å¿˜è®°å…¬å¼ä¸­çš„è´Ÿå·

</details>
```

**4. å‰ç«¯æ¸²æŸ“**
- Markdown æ¸²æŸ“å™¨å¤„ç†æ ¼å¼
- KaTeX æ¸²æŸ“æ•°å­¦å…¬å¼ $x^2$, $(2, -1)$ ç­‰
- GeoGebra ç”»æ¿æ˜¾ç¤ºå‡½æ•°å›¾åƒ
- Details æ ‡ç­¾å®ç°ç­”æ¡ˆæŠ˜å 

---

## ğŸ“š æŠ€æœ¯è¦ç‚¹æ€»ç»“

### LaTeX æ¸²æŸ“
- **åº“æ ˆ**: react-markdown â†’ remark-math â†’ rehype-katex
- **CSS**: å¿…é¡»å¼•å…¥ `katex/dist/katex.min.css`
- **å…¼å®¹æ€§**: æ”¯æŒ `$...$` å’Œ `\(...\)` ä¸¤ç§è¯­æ³•

### å·¥å…·è°ƒç”¨å¾ªç¯
- **æ¨¡å¼**: æ‰‹åŠ¨å¾ªç¯ï¼ˆLangChain 1.0 æ¨èï¼‰
- **æ–¹æ³•**: `model.bindTools(tools)`
- **æ£€æŸ¥**: `response.tool_calls`
- **æ‰§è¡Œ**: è°ƒç”¨ `tool.execute(args)`
- **æ¶ˆæ¯**: æ·»åŠ  `{ role: 'tool', content, tool_call_id }` ç»§ç»­å¯¹è¯

### æ™ºèƒ½ä½“æ¶æ„
- **base class**: `Agent` (å®šä¹‰åœ¨ `types/agent.ts`)
- **æ ¸å¿ƒæ–¹æ³•**: `chat(messages, aiConfig): Promise<ChatResponse>`
- **å·¥å…·æ”¯æŒ**: `getTools(): AgentTool[]`
- **é…ç½®**: `getConfig(): AgentConfig`

---

## ğŸ”¬ å¯¹æ¯”ï¼šæ”¹è¿›å‰ vs æ”¹è¿›å

| ç‰¹æ€§ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| **æ•°å­¦å…¬å¼** | åŸå§‹ LaTeX ä»£ç  | âœ… ç¾è§‚çš„æ•°å­¦å…¬å¼æ¸²æŸ“ |
| **Markdown** | çº¯æ–‡æœ¬ | âœ… å®Œæ•´ Markdown æ”¯æŒ |
| **ç»ƒä¹ é¢˜å¯è§†åŒ–** | âŒ æ— å›¾åƒ | âœ… è‡ªåŠ¨ GeoGebra é…å›¾ |
| **ç­”æ¡ˆæŠ˜å ** | âŒ ä¸æ”¯æŒ | âœ… details/summary æ ‡ç­¾ |
| **å‡½æ•°å›¾åƒ** | éœ€æ‰‹åŠ¨åˆ‡æ¢æ™ºèƒ½ä½“ | âœ… ç»ƒä¹ é¢˜æ™ºèƒ½ä½“è‡ªåŠ¨ç»˜å›¾ |
| **å­¦ä¹ ä½“éªŒ** | æ–‡å­—ä¸ºä¸» | âœ… å›¾æ–‡å¹¶èŒ‚ï¼Œç›´è§‚æ˜“æ‡‚ |

---

## ğŸš€ æœªæ¥å¯èƒ½çš„æ”¹è¿›

### 1. äº¤äº’å¼å¯è§†åŒ–
- è®©å­¦ç”Ÿå¯ä»¥åœ¨ GeoGebra ç”»æ¿ä¸Šæ‹–åŠ¨ç‚¹
- è§‚å¯Ÿå‡½æ•°å›¾åƒçš„å˜åŒ–
- æ¢ç´¢æ•°å­¦æ¦‚å¿µ

### 2. é”™é¢˜æœ¬é›†æˆ
- è®°å½•å­¦ç”Ÿåšé”™çš„é¢˜ç›®
- è‡ªåŠ¨ç”Ÿæˆç›¸ä¼¼é¢˜ç›®
- é…åˆå¯è§†åŒ–åŠ æ·±ç†è§£

### 3. éš¾åº¦è‡ªé€‚åº”
- æ ¹æ®å­¦ç”Ÿç­”é¢˜æ­£ç¡®ç‡
- åŠ¨æ€è°ƒæ•´é¢˜ç›®éš¾åº¦
- æ™ºèƒ½æ¨èç»ƒä¹ å†…å®¹

### 4. å¤šæ¨¡æ€è¾“å…¥
- æ”¯æŒå­¦ç”Ÿæ‰‹å†™å…¬å¼ï¼ˆOCRï¼‰
- è¯†åˆ«å¹¶è‡ªåŠ¨å¯è§†åŒ–
- æä¾›å³æ—¶åé¦ˆ

---

## ğŸ“– å¼€å‘è€…æŒ‡å—

### å¦‚ä½•æ·»åŠ æ–°çš„å¯è§†åŒ–å·¥å…·

**æ­¥éª¤ 1ï¼šå®šä¹‰å·¥å…·**
```typescript
// server/src/services/new-tools.ts
export const newTools = [
  {
    name: 'new_tool',
    description: 'å·¥å…·æè¿°',
    schema: { /* Zod schema */ },
    execute: async (params) => { /* å®ç° */ }
  }
];
```

**æ­¥éª¤ 2ï¼šåœ¨æ™ºèƒ½ä½“ä¸­å¼•ç”¨**
```typescript
import { newTools } from '../services/new-tools';

export class MyAgent extends Agent {
  getTools() {
    return [...geogebraTools, ...newTools];
  }
}
```

**æ­¥éª¤ 3ï¼šæ›´æ–°ç³»ç»Ÿæç¤ºè¯**
å‘Šè¯‰ AI ä½•æ—¶è°ƒç”¨æ–°å·¥å…·ã€‚

---

## âœ… æµ‹è¯•æ¸…å•

- [x] LaTeX è¡Œå†…å…¬å¼æ¸²æŸ“æ­£ç¡®
- [x] LaTeX ç‹¬ç«‹å…¬å¼å±…ä¸­æ˜¾ç¤º
- [x] Markdown æ ‡é¢˜ã€åˆ—è¡¨æ­£ç¡®è§£æ
- [x] ä»£ç å—è¯­æ³•é«˜äº®
- [x] details/summary æŠ˜å åŠŸèƒ½
- [x] ç»ƒä¹ é¢˜æ™ºèƒ½ä½“è‡ªåŠ¨è°ƒç”¨ GeoGebra å·¥å…·
- [x] å·¥å…·è°ƒç”¨å¾ªç¯æ­£ç¡®æ‰§è¡Œ
- [x] å¤šä¸ªå‡½æ•°å¯åŒæ—¶ç»˜åˆ¶
- [x] GeoGebra ç”»æ¿ä»…åœ¨ç›¸å…³æ™ºèƒ½ä½“æ˜¾ç¤º
- [x] ç»ƒä¹ é¢˜æ™ºèƒ½ä½“åˆ‡æ¢æ—¶ç”»æ¿æ­£ç¡®æ˜¾ç¤º/éšè—

---

**æ€»ç»“**ï¼š
é€šè¿‡å¼•å…¥ LaTeX æ¸²æŸ“å’Œæ™ºèƒ½å·¥å…·è°ƒç”¨ï¼Œæ•°å­¦æ•™å­¦ç³»ç»Ÿçš„ç”¨æˆ·ä½“éªŒå¾—åˆ°æ˜¾è‘—æå‡ã€‚å­¦ç”Ÿç°åœ¨å¯ä»¥ï¼š
1. çœ‹åˆ°ç¾è§‚çš„æ•°å­¦å…¬å¼ï¼ˆä¸æ˜¯ä»£ç ï¼‰
2. è‡ªåŠ¨è·å¾—é…å¥—çš„å¯è§†åŒ–å›¾åƒ
3. é€šè¿‡æŠ˜å ç­”æ¡ˆè‡ªä¸»å­¦ä¹ 

è¿™ä¸¤ä¸ªæ”¹è¿›å®Œç¾å¥‘åˆäº†åˆé«˜ä¸­æ•°å­¦æ•™å­¦çš„å®é™…éœ€æ±‚ï¼ ğŸ“
