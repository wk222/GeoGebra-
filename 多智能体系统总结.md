# å¤šæ™ºèƒ½ä½“æ•°å­¦æ•™å­¦ç³»ç»Ÿ - æ€»ç»“ä¸æ”¹è¿›

## ğŸ“Š å·²å®ç°çš„æ™ºèƒ½ä½“ï¼ˆ4ä¸ªï¼‰

### 1. ğŸ“Š GeoGebra å¯è§†åŒ–åŠ©æ‰‹
- **åŠŸèƒ½**ï¼šåˆ›å»ºæ•°å­¦å›¾å½¢å’Œå¯è§†åŒ–
- **ç‰¹ç‚¹**ï¼š7ä¸ª GeoGebra å·¥å…·ï¼Œæ”¯æŒå‡½æ•°ã€ç§¯åˆ†ã€å‡ ä½•å›¾å½¢
- **ç•Œé¢**ï¼šæœ‰ GeoGebra ç”»æ¿

### 2. ğŸ§® è§£é¢˜æ­¥éª¤åˆ†è§£å™¨
- **åŠŸèƒ½**ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£æˆè¯¦ç»†æ­¥éª¤
- **ç‰¹ç‚¹**ï¼šç»“æ„åŒ–è§£é¢˜æµç¨‹ï¼Œé€‚åˆå­¦ä¹ è§£é¢˜æ€è·¯
- **ç•Œé¢**ï¼šçº¯æ–‡æœ¬ï¼Œæ— ç”»æ¿

### 3. ğŸ“– æ¦‚å¿µè§£é‡Šä¸“å®¶
- **åŠŸèƒ½**ï¼šç”¨é€šä¿—è¯­è¨€è§£é‡Šæ•°å­¦æ¦‚å¿µ
- **ç‰¹ç‚¹**ï¼šç±»æ¯”æ³•æ•™å­¦ï¼Œå¼ºè°ƒæ¦‚å¿µç†è§£
- **ç•Œé¢**ï¼šçº¯æ–‡æœ¬ï¼Œæ— ç”»æ¿

### 4. ğŸ“ ç»ƒä¹ é¢˜ç”Ÿæˆå™¨ (NEW!)
- **åŠŸèƒ½**ï¼šæ ¹æ®çŸ¥è¯†ç‚¹ç”Ÿæˆåˆ†çº§ä¹ é¢˜
- **ç‰¹ç‚¹**ï¼š
  - æ”¯æŒéš¾åº¦åˆ†çº§ï¼ˆâ­ ç®€å• / â­â­ ä¸­ç­‰ / â­â­â­ å›°éš¾ï¼‰
  - å¤šç§é¢˜å‹ï¼ˆé€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜ã€è§£ç­”é¢˜ï¼‰
  - å®Œæ•´ç­”æ¡ˆå’Œè¯¦ç»†è§£æ
  - æ˜“é”™ç‚¹æç¤º
- **ç•Œé¢**ï¼šçº¯æ–‡æœ¬ï¼Œæ— ç”»æ¿

---

## ğŸ¨ ç•Œé¢ä¼˜åŒ– - åŠ¨æ€ç”»æ¿æ˜¾ç¤º

### âœ… å·²å®ç°
- **æ™ºèƒ½åˆ¤æ–­**ï¼šåªæœ‰ GeoGebra æ™ºèƒ½ä½“æ—¶æ˜¾ç¤ºç”»æ¿
- **å¸ƒå±€è‡ªé€‚åº”**ï¼š
  - GeoGebra æ™ºèƒ½ä½“ï¼šå·¦ä¾§èŠå¤© (40%) + å³ä¾§ç”»æ¿ (60%)
  - å…¶ä»–æ™ºèƒ½ä½“ï¼šå…¨å±èŠå¤© (100%)
- **å¹³æ»‘è¿‡æ¸¡**ï¼šä½¿ç”¨ CSS transition å®ç°æµç•…åˆ‡æ¢

### ä»£ç å®ç°
```typescript
// App.tsx
const showGeoGebra = selectedAgentId === 'geogebra';

<div style={{ 
  width: showGeoGebra ? '40%' : '100%', 
  transition: 'width 0.3s ease'
}}>
  <ChatPanel />
</div>

{showGeoGebra && (
  <div style={{ flex: 1 }}>
    <GeoGebraPanel />
  </div>
)}
```

---

## ğŸ’¡ åˆé«˜ä¸­æ•°å­¦æ•™å­¦è¿˜éœ€è¦çš„æ™ºèƒ½ä½“åˆ›æ–°

### æ¨èå¢åŠ çš„æ™ºèƒ½ä½“ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š

#### â­â­â­ é«˜ä¼˜å…ˆçº§

1. **ğŸ“ ç»ƒä¹ é¢˜ç”Ÿæˆå™¨** âœ… å·²å®ç°
   - æ ¹æ®çŸ¥è¯†ç‚¹ç”Ÿæˆä¹ é¢˜
   - éš¾åº¦åˆ†çº§ï¼Œè‡ªåŠ¨å‡ºé¢˜

2. **ğŸ” é”™é¢˜åˆ†æå¸ˆ** (Error Analyzer)
   - åˆ†æå­¦ç”Ÿè§£é¢˜é”™è¯¯
   - è¯Šæ–­çŸ¥è¯†è–„å¼±ç‚¹
   - ç»™å‡ºé’ˆå¯¹æ€§å­¦ä¹ å»ºè®®
   - æ¨èï¼šå®ç°å·¥å…·ï¼š`analyze_error(question, student_answer, correct_answer)`

3. **ğŸ’¬ è‹æ ¼æ‹‰åº•å¯¼å¸ˆ** (Socratic Tutor)
   - é€šè¿‡æé—®å¼•å¯¼æ€è€ƒ
   - ä¸ç›´æ¥ç»™ç­”æ¡ˆï¼Œå¯å‘å¼æ•™å­¦
   - åŸ¹å…»ç‹¬ç«‹æ€è€ƒèƒ½åŠ›
   - æ¨èï¼šSystem Prompt è®¾è®¡ä¸º"åªæé—®ï¼Œä¸ç›´æ¥è§£ç­”"

#### â­â­ ä¸­ä¼˜å…ˆçº§

4. **ğŸ“š çŸ¥è¯†ç‚¹æ¢³ç†å™¨** (Concept Mapper)
   - æ¢³ç†çŸ¥è¯†ç‚¹ä¹‹é—´çš„å…³ç³»
   - ç”Ÿæˆæ€ç»´å¯¼å›¾ï¼ˆMarkdown æ ¼å¼ï¼‰
   - åˆ¶å®šå­¦ä¹ è·¯å¾„

5. **ğŸ“‹ ä½œä¸šæ‰¹æ”¹åŠ©æ‰‹** (Homework Grader)
   - æ£€æŸ¥ç­”æ¡ˆæ­£ç¡®æ€§
   - ç»™å‡ºè¯„åˆ†å’Œå»ºè®®
   - æŒ‡å‡ºè§£é¢˜ä¸­çš„ä¼˜ç‚¹å’Œé—®é¢˜

6. **ğŸ¯ è€ƒå‰å¤ä¹ åŠ©æ‰‹** (Exam Reviewer)
   - æ ¹æ®è€ƒè¯•èŒƒå›´ç”Ÿæˆå¤ä¹ è®¡åˆ’
   - æ€»ç»“é‡ç‚¹å…¬å¼å’Œå®šç†
   - æ¨¡æ‹Ÿè€ƒé¢˜ç”Ÿæˆ

#### â­ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰

7. **ğŸ“– æ•°å­¦å²è®²è§£å‘˜** (Math Historian)
   - è®²è¿°æ•°å­¦æ¦‚å¿µçš„å†å²èƒŒæ™¯
   - ä»‹ç»æ•°å­¦å®¶æ•…äº‹
   - å¢åŠ å­¦ä¹ è¶£å‘³æ€§

8. **ğŸ§© åˆ›æ„åº”ç”¨è®¾è®¡å¸ˆ** (Creative Problem Designer)
   - å°†æ•°å­¦ä¸ç”Ÿæ´»åœºæ™¯ç»“åˆ
   - è®¾è®¡è¶£å‘³æ•°å­¦åº”ç”¨é¢˜
   - è·¨å­¦ç§‘é—®é¢˜è®¾è®¡

---

## ğŸ¤– å…³äº createAgent ç”¨æ³•

### âŒ LangChain 1.0 å·²åºŸå¼ƒ `createAgent`

åœ¨ LangChain 0.x ç‰ˆæœ¬ä¸­ï¼Œæœ‰ `createOpenAIFunctionsAgent`ã€`createReactAgent` ç­‰æ–¹æ³•ã€‚

**LangChain 1.0 é‡å¤§å˜æ›´ï¼š**
- âŒ `createAgent` ç³»åˆ—æ–¹æ³•å·²è¢«**åºŸå¼ƒ**
- âœ… æ¨èä½¿ç”¨ **æ‰‹åŠ¨å¾ªç¯** æˆ– **LangGraph**

### âœ… æˆ‘ä»¬é¡¹ç›®ä¸­çš„æœ€ä½³å®è·µï¼ˆæ‰‹åŠ¨å¾ªç¯ï¼‰

æˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ³•æ­£æ˜¯ LangChain 1.0 æ¨èçš„æ–¹å¼ï¼š

#### å®ç°æ¨¡å¼
```typescript
class GeoGebraAgent extends Agent {
  async chat(messages: Message[], aiConfig: any): Promise<ChatResponse> {
    // 1. åˆ›å»ºæ¨¡å‹å®ä¾‹ï¼ˆæ”¯æŒè‡ªå®šä¹‰ baseURLï¼‰
    const model = new ChatOpenAI({
      model: aiConfig.model,
      apiKey: aiConfig.apiKey,
      configuration: { baseURL: aiConfig.baseURL },
    });

    // 2. ç»‘å®šå·¥å…·ï¼ˆbindTools æ˜¯ 1.0 æ–°æ–¹æ³•ï¼‰
    const modelWithTools = model.bindTools(
      geogebraTools.map(tool => ({
        name: tool.name,
        description: tool.description,
        parameters: tool.schema,
      }))
    );

    // 3. æ‰‹åŠ¨å¾ªç¯ï¼ˆæœ€å¤š5è½®ï¼‰
    let currentMessages = [...conversationMessages];
    let iterations = 0;
    const maxIterations = 5;

    while (iterations < maxIterations) {
      const response = await modelWithTools.invoke(currentMessages);

      // 4. æ£€æŸ¥æ˜¯å¦æœ‰å·¥å…·è°ƒç”¨
      if (!response.tool_calls || response.tool_calls.length === 0) {
        // æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å›æœ€ç»ˆç­”æ¡ˆ
        return { message: response, toolCalls: allToolCalls };
      }

      // 5. æ‰§è¡Œå·¥å…·
      for (const toolCall of response.tool_calls) {
        const tool = geogebraTools.find(t => t.name === toolCall.name);
        const result = await tool.execute(toolCall.args);
        
        // 6. å°†ç»“æœæ·»åŠ åˆ°æ¶ˆæ¯å†å²
        currentMessages.push(
          new ToolMessage({
            tool_call_id: toolCall.id,
            content: JSON.stringify(result),
          })
        );
      }

      iterations++;
    }
  }
}
```

#### ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ

1. **å…¼å®¹è‡ªå®šä¹‰ API**ï¼šæˆ‘ä»¬çš„è‡ªå®šä¹‰ API (http://185.183.98.135:3000) ä¸æ”¯æŒåŸç”Ÿ agent
2. **å®Œå…¨æ§åˆ¶å¾ªç¯**ï¼šå¯ä»¥è‡ªå®šä¹‰æœ€å¤§è¿­ä»£æ¬¡æ•°ã€ç»ˆæ­¢æ¡ä»¶
3. **æ›´å¥½çš„è°ƒè¯•**ï¼šæ¯ä¸€æ­¥éƒ½æ¸…æ™°å¯è§
4. **LangChain 1.0 æ¨è**ï¼šå®˜æ–¹æ–‡æ¡£æ˜ç¡®æ¨èæ­¤æ–¹æ³•

### ğŸ“š å…³é”®æ–¹æ³•

#### 1. `model.bindTools(tools)` - ç»‘å®šå·¥å…·
```typescript
const modelWithTools = model.bindTools([
  {
    name: "calculator",
    description: "Perform calculations",
    parameters: { type: "object", properties: {...} }
  }
]);
```

#### 2. æ‰‹åŠ¨æ£€æŸ¥ `tool_calls`
```typescript
if (response.tool_calls && response.tool_calls.length > 0) {
  // æœ‰å·¥å…·è°ƒç”¨ï¼Œç»§ç»­å¾ªç¯
  for (const toolCall of response.tool_calls) {
    // æ‰§è¡Œå·¥å…·...
  }
} else {
  // æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œç»“æŸå¾ªç¯
  return response;
}
```

#### 3. ä½¿ç”¨ `ToolMessage` è¿”å›ç»“æœ
```typescript
import { ToolMessage } from '@langchain/core/messages';

currentMessages.push(
  new ToolMessage({
    tool_call_id: toolCall.id,
    content: JSON.stringify(result),
  })
);
```

---

## ğŸ¯ å¦‚ä½•æ·»åŠ æ–°æ™ºèƒ½ä½“

### æ­¥éª¤ï¼ˆä»¥ç»ƒä¹ é¢˜ç”Ÿæˆå™¨ä¸ºä¾‹ï¼‰ï¼š

#### 1. åˆ›å»º Agent ç±»
```typescript
// server/src/agents/exercise-generator-agent.ts
export class ExerciseGeneratorAgent extends Agent {
  constructor() {
    super({
      id: 'exercise-generator',
      name: 'ç»ƒä¹ é¢˜ç”Ÿæˆå™¨',
      description: 'ç”Ÿæˆåˆ†çº§ä¹ é¢˜...',
      icon: 'ğŸ“',
      systemPrompt: `ä½ æ˜¯ä¹ é¢˜ç”Ÿæˆä¸“å®¶...`,
      tools: [],  // ä¸éœ€è¦å·¥å…·
      enabled: true,
    });
  }

  getTools() {
    return [];  // çº¯æ–‡æœ¬æ™ºèƒ½ä½“ï¼Œæ— å·¥å…·
  }

  async chat(messages, aiConfig) {
    // åˆ›å»ºæ¨¡å‹
    const model = this.createModelInstance(aiConfig);
    
    // è°ƒç”¨æ¨¡å‹
    const response = await model.invoke([
      { role: 'system', content: this.config.systemPrompt },
      ...messages
    ]);
    
    return { message: response, toolCalls: [] };
  }
}
```

#### 2. æ³¨å†Œæ™ºèƒ½ä½“
```typescript
// server/src/agents/index.ts
import { ExerciseGeneratorAgent } from './exercise-generator-agent';

export function initializeAgents() {
  agentOrchestrator.registerAgent(new ExerciseGeneratorAgent());
}
```

#### 3. å‰ç«¯è‡ªåŠ¨åŠ è½½
å‰ç«¯ä¼šé€šè¿‡ `GET /api/chat/agents` è‡ªåŠ¨è·å–æ‰€æœ‰æ™ºèƒ½ä½“ï¼Œæ— éœ€ä¿®æ”¹å‰ç«¯ä»£ç ï¼

---

## ğŸš€ ç³»ç»Ÿæ¶æ„ä¼˜åŠ¿

### 1. æ¨¡å—åŒ–è®¾è®¡
- æ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹å°è£…
- æ˜“äºæ·»åŠ /åˆ é™¤/ä¿®æ”¹

### 2. ç»Ÿä¸€æ¥å£
- æ‰€æœ‰æ™ºèƒ½ä½“å®ç°ç›¸åŒçš„ `Agent` æ¥å£
- å‰ç«¯æ— éœ€å…³å¿ƒæ™ºèƒ½ä½“å†…éƒ¨å®ç°

### 3. çµæ´»é…ç½®
- æ”¯æŒ OpenAI / Anthropic / è‡ªå®šä¹‰ API
- æ¯ä¸ªæ™ºèƒ½ä½“å¯ç‹¬ç«‹é…ç½®å‚æ•°

### 4. å¯æ‰©å±•æ€§
- æ·»åŠ æ–°æ™ºèƒ½ä½“åªéœ€ 2 æ­¥
- æ”¯æŒå·¥å…·è°ƒç”¨å’Œçº¯æ–‡æœ¬æ™ºèƒ½ä½“

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥å»ºè®®

### æ¨èå®ç°é¡ºåºï¼š

1. âœ… **ç»ƒä¹ é¢˜ç”Ÿæˆå™¨** - å·²å®Œæˆ
2. **é”™é¢˜åˆ†æå¸ˆ** - å¯¹å­¦ä¹ æå‡æœ€æœ‰å¸®åŠ©
3. **è‹æ ¼æ‹‰åº•å¯¼å¸ˆ** - æå‡æ•™å­¦è´¨é‡
4. **çŸ¥è¯†ç‚¹æ¢³ç†å™¨** - å¸®åŠ©ç³»ç»ŸåŒ–å­¦ä¹ 
5. å…¶ä»–æ™ºèƒ½ä½“æ ¹æ®éœ€æ±‚é€æ­¥æ·»åŠ 

### æŠ€æœ¯æ”¹è¿›ï¼š

- [ ] æ·»åŠ æ™ºèƒ½ä½“ä¹‹é—´çš„åä½œï¼ˆå¤šæ™ºèƒ½ä½“å¯¹è¯ï¼‰
- [ ] å®ç°å¯¹è¯å†å²æŒä¹…åŒ–
- [ ] æ·»åŠ æ™ºèƒ½ä½“æ€§èƒ½ç›‘æ§ï¼ˆLangSmithï¼‰
- [ ] æ”¯æŒè‡ªå®šä¹‰æ™ºèƒ½ä½“é…ç½®ï¼ˆç”¨æˆ·å¯è°ƒæ•´ system promptï¼‰

---

**æ€»ç»“**ï¼š
- âœ… ç”»æ¿åŠ¨æ€æ˜¾ç¤ºå·²å®ç°
- âœ… æ–°å¢ç»ƒä¹ é¢˜ç”Ÿæˆå™¨ç¤ºä¾‹
- âœ… æ‰‹åŠ¨å¾ªç¯æ˜¯ LangChain 1.0 æœ€ä½³å®è·µ
- ğŸ¯ ç³»ç»Ÿæ¶æ„çµæ´»å¯æ‰©å±•ï¼Œæ·»åŠ æ–°æ™ºèƒ½ä½“éå¸¸ç®€å•
